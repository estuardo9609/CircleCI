version: 2.1
jobs:
  # I will install node modules separetly to use a workspace
  install:
    executor: node/default
    steps:
      - checkout
      # Install project packages to get node modules
      - node/install-packages:
          override-ci-command: npm install
          cache-path: node_modules
      - run:
          command: |
            echo "I have succesfully installed my node modules, trying to "
      # Since I have my node modules i will take them to workspace
      # https://discuss.circleci.com/t/understanding-persist-to-workspace/31369
      - persist_to_workspace:
          root: ~/
          paths:
            - project/node_modules
  
  # I will run my tests now
  test:
    executor: node/default
    steps:
      - checkout
      - attach_workspace:
          at: project/node_modules
      - node/install-npm
      - run:
          command: npm run test
  
orbs:
  # https://circleci.com/developer/orbs/orb/circleci/node
  node: circleci/node@4.1.0

workflows:
  version: 2
  test:
    jobs:
      - install
      - test:
          requires:
            - install
  